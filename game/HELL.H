; Hell in your dreams...
; Code begin: 26.11.01 ... Начало ли только?
; --
; очень большая пауза - до 10марта2003 года, 3 или 4 месяца
; практически на брался, только иногда загружал и бегал.
; (256 сессия)

;Идеи / баги / надо:
; 10. музыка в определенных местах??? по ситуации? рулез. только
;     музакера нет! фак!
;+-11. события: наступил на опред. место (любое живое существо
;     игры, определенное естественно :) ), персонаж оказался в
;     определенном квадрате карты (по-знакоместно), действие
;     персонажа (если прыгнул - полетел :))), сел на колени в
;     определенном месте - переместился в потайную комнату,
;     толкнул чего-либо - закрылся единственный выход
;+-13. таком образом карта локации состоит из описания нерушимой
;     локации, триггеров (типа есть такая то группа спрайтов
;     там-то), карты проходимости, карты монстров (ее опишу ниже
;     наверное), языка действий (в конце - четыре байта номеров
;     локаций, в которые можно попасть из этой комнаты), карты
;     предметов.
; 27. Идея!!!! МАКРОС peremennaq=1,var2=2
;-43. идея игры - 1000 и 1 сектор :)
; 45. использовать команды типа BIT 4,(IX+#12) для определения
;     жизненно важных параметров героя.
;+47. идея хранения графики: сначала атрибут(ы), затем - знако-
;     места, если атрибут=0 - знакоместо отсутствует.
;+48. руны, ключи, оружие... обьединять в группы.
;+49. возможно: для всех монстров оттвести по два байта буфера
;     в которых хранить их координаты в комнате пока наш герой
;     где-то шляется.
;-50. идея: может начать игру так: куча костей. нет, КУЧА костей
;     Никого. Нажимаешь 'вверх' - встает наш, родимый, хероист.
;-56. головоног: при хотьбе будет видеть на 3 в обе стороны,
;     если увидит хера - кончает тормозить и бежит на него;
;     иногда будет подниматься на ноги, при этом будет видеть
;     (нюхом) на 10 в обе стороны. Если унюхает, бежит в сторону
;     запаха до упора или до хероя
;-57. черепонод: при пинке отлетает к стенке. а может даже
;     падает. вряд ли
;-
;-64. может сделать альтернативное применение монетки - бросил в
;     какой-нить фонтан, получил жизнь на счастие?
;-
; 71. при собирании предмета соответствующее место (жизни,
;     руны, предметы) зажечь и погасить.
; 72. сделать место, в котором будут бесконечные файрболы -
;     собрал допустим, а через некоторое время чего-либо капает
;     например, и куда упало - там новый запас файрболов появля-
;     ется
;-73. основное оружие меч? Можно начать игру с того, что
;     меч будет стоять рядом, воткнутый в землю - т.е. не так,
;     как все остальные предметы, и мигать слегка
;-
;+75. в подземельях весь потолок усеять синими сталл"октитами -
;     будет казаться, что пещеры уходят в даль - псевго 3д :)
;+76. слишком часто встречаются сиреневые булыжники на красном
;     фоне - нихрена не вписываются !!!
; 78. можно при установке руны по всей локации какие-нибудь
;     энергетические всплески произвести, есесьно спрайтами
;     1 на 1, а траектория - моя трабла.
;-
;-79. может одним из монстров сделать девушку? она, есесьно,
;     будет плеваться или кидаться всякой фигней, но, как только
;     отдашь ей ожерелье, так она и оттает.
;-83. интеллект реброногов: бегут до края, там - разворачиваются
;     и, если меня нет, идут уже спокойно :)
;-
;-84. интеллект тота: стоит на месте, время от времени делает
;     шаг вперед. если я близко, то он ждет некоторое время,
;     затем начинает сам подходить без пауз и бьет и бьет. если
;     я сам подхожу - он улучает момент и бьет по яйцам :)
;-
;-86. нужно добавить еще выключателей, и! разбросать их! мне
;     даже скучно становится идти и все подряд нажимать! Можно
;     сделать под каким-нибудь из ключей дыру, которая как-раз и
;     будет закрываться рычагом.
;+-87. может со спрутом так: подходишь, рубишь мечом щупальцу,
;     (они подмигивают), после трех-четырех раз шупальца взрыва-
;     ется, затем так со всеми остальными, забираешь руну и бежи
;     шь скорее назад, иначе - шупальца начинают появляться (ми-
;     гая при этом). чем это грозит - пока не знаю, наверное быс
;     трой тратой энергии (значит надо за один шаг процентов 75
;     снять с героя)
;-
; 88. если обнаружу, что гама пропатчена насчет жизней, то неко-
;     торые двери не должны открыться!
;-89. для того, чтоб быстро убить героя будет своя проца, в иных
;     случаях будет действовать проца уменьшения энергии на 1
;     до определенного уровня.
;-
;-90. насчет паука: можно сделать, чтобы он пару раз мигал, а
;     затем выпускал во все стороны какую-нить хрень. Да и
;     попадания можно засчитывать только в эти моменты.
;-91. может сделать в главной менюхе маленький тутор? типа
;     показать мелких монстров с их названиями, показателем
;     ии, способом убийства (в анимации)
;-
;+94. пару фаз из движения привидения вверх/вниз убрать! Иначе -
;     криво застревает в моменты перехода из полета вверх в
;     полет вниз и наоборот.
;-96. файрбол взять из пимп, вылетающих уз лавы.
; 99. в места, заифанные по FlyingSkull запис. соотв знач при
;     взломе на предмет жизней и энергии
;-
;+100. глюк в комнате, кас. X=0 - прыжок влево натыкается.
;-
; 102. разбрасывать части скелета при смерти
; 103. полную версию защитить от просмотра
; 104. фонтаны жизни (пару-тройку) - добавляют энергию!!!!!!!!!
;+106. после смерти можно изобразить вылетание духа из склета,
;      полет вверх и распыление.
;-107. плевки вправо и влево от привидения скорее должны пред-
;      ставлять собой не стрелки, а сгустки
;-
; 112. через двуголового пролетают файрболы.
;+113. еще один глюк с цветком - можно пробежать мимо, т.е.
;      перешагнуть (смерть наступит, но цветок раскроется раньше
;      времени)
;+114. после смерти в цветке, его раскрыть, но и прозрак остав.
; 115. какой-нибудь спрайт смерти в щупальцах. или просто разбро
;      сать свои руки/ноги?
;-
;+116. при получении жизни энергию восстановить.
;-
;+117. перед взятием жизни, проверить, нужно ли.
;-
; 118! после тушения/зажигания экрана пересоздать таблицу вывода
;      знакомест на экран.

;---------------------------------------
;интро
;оутро
;
;Гл.меню
; показывать демку игры
;-экран д. иметь 3 плана - задний, демка, передний (знакоместа
;-  переднего плана выделять для меня флашем).
; надписи обычным шрифтом 8на8 пикс. писать их как есть, что
;  под ними - кидать в буфер и отмечать как невидимое знакоместо
;
;Движок:
;*хранить параметры монстров
; постепенное накапливание энергии
; атрибутный эффект при взятии и установке рун
;*атрибутный эффект при взятии предмета
;*циферки количества предмета
;* если много, подсвечивать светлым, если мало-мигать,нет-синим
; фикс графики
;* невидимые видимые знакоместа (на могилах например)
; !!! главное меню и ИНИЦИАЛИЗАЦИЯ ВСЕХ ПЕРЕМЕННЫХ ГАМЫ !!!
;
; разбивание ящиков и кувшинов
;  возможно - осколки
;?всяческие энергетические всплески
;
;Предметы:
; монетки
;?молот
;*капканы на мумий
;*жизнь
;*стрелы
;?свиток
; алмаз
;*крест
;* не должно быть отклика на файр
;
;Монстрики:
;*гейзер
;* перерисовать!
; паук
;* удар тока
;  отлетание от пинка
; реброног
;  если убегает - убегает и разворачивается, нападает
;  если встает, смотрит вдаль (спереди до конца экрана)
;* отлетание от пинка
;*мумия
;*тот
; двуголовый
;  мечом убивать (одного раза достаточно)
;  убивать кулаком
;* что-то делать, когда он стоит в одном знакоместе со мной
;- (например, отбирать энергию)
;*ведьма
;*привидение-балахон
;* улучшить разум
;* урон херу от выстрелов и соприкосновения
;- нужно ли убивать привидение файрболом?
; хакер
;
;Мега-Монстры:
;*паук
;*тифон
;* огоньки после отрыжек :)
;*привидение-карлсон
; шупальцы
;  при обрубании какие-нить разлет. хрени
;*тучка
;
;звуки:
; взятие и применение руны
; взятие и потеря жизни
; взятие предметов
; выстрел файрбола
; выстрел и попадание стрелы
; меч
; повреждение монстра (для каждого свой)
; капля
; поздравление - успешное применение предмета (взятие или прине-
;   сение креста)
; паук
; тучка
;
;герой:
; анимированная смерть
;*смерть в лаве - возможно расплавление..
;*сделать нормальные файрболы
;*стрельба из лука
;*полный фикс прыжков
;* глюки с приземлениями не в те знакоместа
;* глюки при столкновениях с препятствиями
;
;8.6.2 ****
;15.6.2 ***
;13.10.2 *
;14.10.2 **
;15.10.2 **
;16.3.3 ++
;17.3.3 *
;6.6.3 музыка, крест и картинка гамовера
;07 панель и бэкграунд - спрайты
;09 почти доделал выводилку на экран (мигает блэком)
;10-11 выводилка готова (возможны изменения, но...)
;12 перевставил карту
;13 верхние скелики шагают!
;14 умирает; добавляется жизнь (веселые верхние скелетики)
;15 сиса :(
;16 вставил лук, уже стреляет, не попадает.
;22 интру пинал немного
;28 пиксы летают. криво.
;3.7
;6 мумии шагают (бестолково)
;12 снова видно мегамонстров+немного кривых звуков
;13 нельзя перешагнуть лист
;15 запоминаются координаты монстров! (криво :)
;23 монстры оживают. составил б-м полный план работы (бумажный)
;---------------------------------------

        MAIN "",#C0

        IF ?SAVEOBJ-2
        DISPLAY "чистка памяти..."
        ORG #6000,0
        DS #A000
        ORG #C000,1
        DS #4000
        ORG #C000,3
        DS #4000
        ORG #C000,6
        DS #4000
        ORG #C000,7
        DS #4000
        ENDIF 


        INCLUDE "HELLBLD#",#27

        ORG #6000

        INCLUDE "H_Macro",#80
        INCLUDE "H_Vars",#81
        INCLUDE "H_Gui",#82
        INCLUDE "H_Gui2",#83

        INCLUDE "H_MFX",#25
        INCLUDE "MAINMENU",#23
        Epg_agfx=$
        ORG EM_MENU

        IFN ?SAVEOBJ-2
        DISPLAY "резидент STD2 в памяти"
;       IF ?std2-1
std2    PUSH AF
        LD A,9
        OUT (0),A
        POP AF
        JP #66
;       ENDIF
        ENDIF 

tblMEGA
megatbl DS 8*5+1 ;(7 монстров+по умолчанию) по 5 байт + заглушка

GGFX    DS #8C6 ;буфер для МЕГАмонстров (хотя они ткие милые!)

        INCLUDE "Go",#C1

        DISPLAY "4outro: ",/T,golft01-GGFX

        INCLUDE "runs",#C1 ;,#C2
        INCLUDE "goudz",#C1 ;,#C3
        INCLUDE "Runes",#C1 ;,#C4
        INCLUDE "AddGfx",#C1 ;,#20


EGGFX   DISPLAY "GFX=",$-GGFX
Epg_main

        ORG #C000,fzs_pg
        INCLUDE "H_Hero",#84
        INCLUDE "H_Hero2",#22
        DISPLAY "EndOfHer",$
        INCLUDE "H_MonRun",#85
        INCLUDE "H_MonRu1",#86
        INCLUDE "H_MonRu2",#24
        INCLUDE "H_Items",#87
Epg_fzs

        ORG #C000,lvl_pg
        DISPLAY "Leveling: 0"
        INCLUDE "rooms000",#41
        DISPLAY "Leveling: 1"
        INCLUDE "rooms001",#42
        DISPLAY "Leveling: 2"
        INCLUDE "rooms002",#43
        DISPLAY "Leveling: 3"
        INCLUDE "rooms003",#44
        DISPLAY "Leveling: 4"
        INCLUDE "rooms004",#45

panel   INCBIN "_panel"
backgr  EQU 5*9*32+panel

nrgspr  DD #17FD555FFD7FABABAFFE8A3FFEAF77F1555F5155F57FEAEA
        DD #BBFEAABABBEFFDFD55FD1D577555FAABAFFFABFEFFFAFDD5

f_ix    DB #FF,#41,'nrgspr,#FF,8,4
;
Epg_gfx

        ORG Epg_agfx,agfx_pg
mmfnt   INCBIN "menufnt" ;[\]^_ - enter,cs,ss,kj,sp
mmlogo  INCBIN "let"

;       время,клавиши,время,клавиши...

        le EQU 2
        ri EQU 1
        do EQU 4
        up EQU 8
        __ EQU 0

ekeytbl
        INCBIN "goself"
ekeyoutrotbl
        INCBIN "gooutro"
ekeystop
        DB 10,0,0

Epg_agfx=$
;---
        ORG #C000,mus_pg_virt
INIT    INCBIN "PTPLAYER",#A2F  ;не грузить лишний раз!
PLAY    EQU INIT+6
Spg_mus
go_muz  INCBIN "MANDRAZH.M"
        ORGXX00 mus_pg_virt
        INCLUDE "H_MFX",#25 ;вторая компиляция :)

        MACRO SOUND
        IFN ?cur_sound
        cur_sound=1
        ENDIF 
        :0=$
        sound_:0=cur_sound
        INCBIN :1
        cur_sound=cur_sound+1
        ENDM 

        IFN ?NoSound
        SOUND mach1,"machine.c"
        SOUND mach2,"machineX.c"
        SOUND kappp,"kapkap.c"
        SOUND sfallscul,"fallscul.C"
        SOUND s2nknif,"2hfire.C"
        SOUND sfireball,"fbal2"
        SOUND sfirebal2,"fball"
        SOUND strela01,"strela01.C"
        SOUND strela02,"strela02.C"
        SOUND pluslife,"takelife.C"
        SOUND twoHLeft,"2h_left.C"
        SOUND lavsnd,"lava.C"
        SOUND titsnd,"takeitem.C"
        SOUND jmptoth,"tohead.C"
        SOUND nozhi,"lovush1.C"
        SOUND brkchest,"brkchest.C"
        SOUND xpehb,"xpehb.C"

sndtbl  DW 0,mach1,mach2,kappp,sfallscul,s2nknif,sfireball
        DW sfirebal2
        DW strela01,strela02,pluslife,twoHLeft,lavsnd,titsnd
        DW jmptoth,nozhi,brkchest,xpehb
        ELSE 
sndtbl  DW 0
        ENDIF 

go_xor  INCBIN "goxorpak" ;пакованная жатая анимация крест-bed
go_scr  INCBIN "DrOv.P"
Epg_mus
;---
        ORG #C000,out_pg_virt
        INCLUDE "L_OUTRO",#C2
Epg_out

        IF ?SAVEOBJ-2
        SAVEOBJ "leth0",#6000,Epg_main-#6000,main_pg
        SAVEOBJ "leth1",#C000,Epg_lvl-#C000,lvl_pg
        SAVEOBJ "leth3",#C000,Epg_gfx-#C000,gfx_pg
        SAVEOBJ "leth4",#CA2F,Epg_mus-#CA2F,mus_pg_virt
        SAVEOBJ "leth6",#C000,Epg_fzs-#C000,fzs_pg
        SAVEOBJ "leth7",#C000,Epg_agfx-#C000,agfx_pg
        SAVEOBJ "letho",#C000,Epg_out-#C000,out_pg_virt
        ENDIF 

        DISPLAY "End of vars ..... (0): ",Epg_vars
        DISPLAY "End of main_pg .. (0): ",Epg_main
        DISPLAY "End of lvl_pg ... (1): ",Epg_lvl
        DISPLAY "End of gfx ...... (3): ",Epg_gfx
        DISPLAY "End of mus_pg ... (4): ",Epg_mus
        DISPLAY "End of fzs_pg ... (6): ",Epg_fzs
        DISPLAY "End of agfx_pg .. (7): ",Epg_agfx
        DISPLAY "End of out_pg .. (1): ",Epg_out
        DISPLAY /T,len_buff4coords

        ORG START

